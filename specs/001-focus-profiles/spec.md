# Спецификация: Профили фокусировки для рабочего использования

**Версия:** 1.0.0  
**Дата:** 2025-10-19  
**Статус:** Draft  
**Связанный план:** TBD

## 1. Обзор

### 1.1 Цель

Предоставить пользователям возможность использовать Telegram исключительно для рабочих целей, минимизируя отвлечения на развлекательный контент, мемы и нерабочие обсуждения. Система профилей позволяет пользователям создавать контекстуальные фильтры видимости контента и уведомлений, обеспечивая фокусировку на приоритетных задачах.

### 1.2 Scope (Область применения)

**В области:**
- Создание и управление профилями просмотра контента
- Фильтрация видимости чатов, каналов и личных сообщений по профилям
- Интеграция с системой папок Telegram
- Управление уведомлениями с учетом активного профиля
- Механизмы whitelist/blacklist для контроля доступа к контактам
- Быстрое переключение между профилями
- Настройка видимости новых контактов
- Профиль по умолчанию с полным доступом

**Вне области:**
- Модерация содержимого сообщений (детекция мемов, спама)
- Автоматическая категоризация чатов по типу контента
- Синхронизация профилей между устройствами (в первой версии)
- Расписание автоматического переключения профилей
- Родительский контроль или корпоративные политики
- Изменение стандартного поведения Telegram API

### 1.3 Пользователи

**Целевая аудитория:**
- Профессионалы, использующие Telegram для работы и личной жизни
- Фрилансеры и удаленные сотрудники
- Менеджеры проектов, координирующие несколько команд
- Люди с ADHD или проблемами концентрации
- Пользователи, стремящиеся к digital wellbeing

**Примеры use cases:**
1. **Разработчик в рабочее время**: Видит только чаты с командой, клиентами и профессиональные каналы. Не видит группы друзей, развлекательные каналы и мемы.

2. **Фрилансер с несколькими проектами**: Создает профиль для каждого клиента, видит только релевантные обсуждения по активному проекту.

3. **Менеджер в режиме "глубокая работа"**: Отключает все уведомления кроме срочных от руководства, фокусируется на задачах без отвлечений.

4. **Родитель в выходной день**: Переключается на личный профиль, скрывает рабочие чаты и получает уведомления только от семьи и друзей.

## 2. Функциональные требования

### FR-1: Создание и редактирование профилей

**Приоритет:** Critical

**Описание:**  
Пользователь может создавать неограниченное количество именованных профилей с настраиваемыми правилами фильтрации контента и уведомлений.

**Acceptance Criteria:**
- [ ] Пользователь может создать новый профиль с уникальным названием (3-30 символов)
- [ ] При создании профиля доступны настройки: название, описание (опционально), иконка/цвет для визуальной идентификации
- [ ] Пользователь может редактировать параметры существующего профиля
- [ ] Пользователь может удалить профиль (кроме профиля "По умолчанию")
- [ ] При удалении профиля запрашивается подтверждение
- [ ] Профиль "По умолчанию" создается автоматически при первом запуске и не может быть удален
- [ ] Все изменения в профилях сохраняются мгновенно без необходимости явного сохранения

**Соответствие конституции:**
- Принцип 3 (UX): Простой и интуитивный интерфейс создания профилей с визуальной идентификацией

---

### FR-2: Фильтрация видимости контента по профилям

**Приоритет:** Critical

**Описание:**  
Каждый профиль определяет, какие чаты, каналы, группы и личные сообщения видимы пользователю при активации этого профиля.

**Acceptance Criteria:**
- [ ] Пользователь может выбрать для профиля: "показать все", "скрыть все" или "выборочно показать/скрыть"
- [ ] В режиме выборочной настройки пользователь может добавлять чаты/каналы в whitelist (видимые) или blacklist (скрытые)
- [ ] Скрытые чаты не отображаются в списке диалогов
- [ ] Скрытые чаты не показывают бейджи с непрочитанными сообщениями
- [ ] Поиск по скрытым чатам не возвращает результатов
- [ ] Прямые ссылки на скрытые чаты показывают предупреждение "Чат скрыт в текущем профиле"
- [ ] Пользователь может временно просмотреть скрытый контент через действие "Показать все на 5 минут"

**Соответствие конституции:**
- Принцип 3 (UX): Четкая визуальная индикация активного профиля и скрытого контента
- Принцип 4 (Производительность): Фильтрация списка диалогов не должна замедлять загрузку интерфейса

---

### FR-3: Интеграция с папками Telegram

**Приоритет:** High

**Описание:**  
Профили могут работать совместно с системой папок Telegram для быстрой настройки видимости целых категорий контента.

**Acceptance Criteria:**
- [ ] Пользователь может включить/выключить видимость целой папки Telegram в профиле одним действием
- [ ] При добавлении новых чатов в папку Telegram, они автоматически учитываются в настройках профиля
- [ ] Пользователь видит список доступных папок при настройке профиля
- [ ] Можно настроить исключения: показать папку, но скрыть отдельные чаты из неё
- [ ] Чаты вне папок рассматриваются как отдельная категория "Без папки"
- [ ] Профиль может фильтровать по нескольким папкам одновременно

**Соответствие конституции:**
- Принцип 3 (UX): Упрощение настройки через группировку чатов по папкам

---

### FR-4: Управление уведомлениями по профилям

**Приоритет:** Critical

**Описание:**  
Каждый профиль определяет правила получения уведомлений: от каких чатов, в какое время и с какой настройкой звука/вибрации.

**Acceptance Criteria:**
- [ ] Пользователь может установить глобальные настройки уведомлений для профиля: "все включены", "все выключены", "выборочно"
- [ ] В выборочном режиме пользователь указывает список чатов с включенными уведомлениями
- [ ] Уведомления от скрытых чатов всегда отключены, независимо от настроек
- [ ] Пользователь может настроить приоритет уведомлений: "критичные", "обычные", "беззвучные"
- [ ] Для каждого уровня приоритета настраиваются параметры: звук, вибрация, отображение на экране блокировки
- [ ] Уведомления показывают индикатор профиля, в котором они были получены
- [ ] Смена профиля немедленно применяет новые правила уведомлений без перезапуска

**Соответствие конституции:**
- Принцип 3 (UX): Мгновенное применение настроек уведомлений при смене профиля

---

### FR-5: Управление видимостью новых контактов

**Приоритет:** Medium

**Описание:**  
Пользователь контролирует, будут ли новые чаты, каналы и контакты автоматически видимы в каждом профиле или потребуется явное добавление.

**Acceptance Criteria:**
- [ ] Для каждого профиля настраивается поведение для новых контактов: "показывать автоматически" или "требуется одобрение"
- [ ] В режиме "требуется одобрение" новые чаты появляются в специальном разделе "На рассмотрении"
- [ ] Пользователь может одобрить или отклонить новый контакт для профиля одним действием
- [ ] Одобренные контакты добавляются в видимые для профиля
- [ ] Отклоненные контакты автоматически добавляются в blacklist профиля
- [ ] Счетчик "На рассмотрении" отображается в интерфейсе управления профилями
- [ ] Новые контакты в профиле "По умолчанию" всегда видны автоматически

**Соответствие конституции:**
- Принцип 3 (UX): Проактивное управление новым контентом без потери контроля

---

### FR-6: Механизмы Whitelist и Blacklist

**Приоритет:** High

**Описание:**  
Пользователь управляет видимостью контента через явные списки разрешенных (whitelist) и запрещенных (blacklist) чатов, каналов и контактов.

**Acceptance Criteria:**
- [ ] Каждый профиль имеет независимые whitelist и blacklist
- [ ] Пользователь может добавить чат/канал/контакт в whitelist или blacklist через контекстное меню
- [ ] Blacklist имеет приоритет над whitelist: если контакт в обоих списках, он скрыт
- [ ] Whitelist/blacklist можно редактировать массово: импорт из CSV, экспорт в CSV
- [ ] Поиск по спискам с фильтрацией по типу (чат/канал/группа/контакт)
- [ ] Статистика: количество контактов в каждом списке
- [ ] Быстрое добавление: "Скрыть во всех профилях" или "Показать только в текущем"

**Соответствие конституции:**
- Принцип 1 (Качество кода): Четкая логика приоритетов списков
- Принцип 3 (UX): Гранулярный контроль над видимостью контента

---

### FR-7: Быстрое переключение между профилями

**Приоритет:** Critical

**Описание:**  
Пользователь может мгновенно переключаться между профилями с минимальным количеством действий.

**Acceptance Criteria:**
- [ ] Переключатель профилей доступен в главном меню приложения (макс. 2 клика)
- [ ] Текущий активный профиль отображается с визуальной индикацией (иконка/цвет) в шапке приложения
- [ ] Список доступных профилей показывает название, иконку и краткое описание
- [ ] Переключение профиля занимает не более 2 секунд
- [ ] После переключения интерфейс обновляется: скрываются/показываются чаты, применяются настройки уведомлений
- [ ] Последний активный профиль восстанавливается при следующем запуске приложения
- [ ] Поддержка keyboard shortcuts для переключения (например, Ctrl+1, Ctrl+2, ..., Ctrl+9 для первых 9 профилей)

**Соответствие конституции:**
- Принцип 3 (UX): Время отклика интерфейса < 100ms при взаимодействии с переключателем
- Принцип 4 (Производительность): Переключение профиля < 2 секунд

---

### FR-8: Профиль по умолчанию

**Приоритет:** Critical

**Описание:**  
Система предоставляет встроенный профиль "По умолчанию", который показывает весь контент без ограничений, обеспечивая стандартное поведение Telegram.

**Acceptance Criteria:**
- [ ] Профиль "По умолчанию" создается автоматически при первой установке
- [ ] В профиле "По умолчанию" видны все чаты, каналы и контакты
- [ ] Уведомления в профиле "По умолчанию" следуют глобальным настройкам Telegram
- [ ] Пользователь не может удалить профиль "По умолчанию"
- [ ] Пользователь может переименовать профиль "По умолчанию", но не может изменить его логику видимости
- [ ] При возникновении ошибок с профилями система автоматически переключается на "По умолчанию"
- [ ] Новые пользователи стартуют с профиля "По умолчанию"

**Соответствие конституции:**
- Принцип 3 (UX): Graceful fallback на безопасный режим работы

---

### FR-9: Быстрая навигация по папкам

**Приоритет:** Medium

**Описание:**  
Пользователь может быстро переключаться между папками Telegram в рамках активного профиля для фокусировки на конкретной категории чатов.

**Acceptance Criteria:**
- [ ] Список папок Telegram отображается в боковой панели или верхней навигации
- [ ] Клик по папке фильтрует список диалогов, показывая только чаты из этой папки
- [ ] Счетчик непрочитанных сообщений отображается для каждой папки
- [ ] Папки, невидимые в текущем профиле, не отображаются в навигации
- [ ] Можно вернуться к просмотру "Все чаты" одним кликом
- [ ] Активная папка визуально выделена
- [ ] Поддержка keyboard shortcuts для быстрой навигации по папкам (Ctrl+Shift+1..9)

**Соответствие конституции:**
- Принцип 3 (UX): Минимизация когнитивной нагрузки через визуальное группирование

## 3. Нефункциональные требования

### NFR-1: Производительность

**Метрики (согласно Принципу 4):**
- Переключение профиля: < 2 секунд (включая перерисовку интерфейса)
- Фильтрация списка диалогов: < 300ms для 1000+ чатов
- Время отклика UI при выборе профиля: < 100ms
- Потребление дополнительной памяти: < 20 MB для хранения профилей и правил
- Применение правил уведомлений: мгновенно (< 50ms)

**Обоснование:** Система профилей не должна замедлять основной функционал мессенджера.

### NFR-2: Надежность

- **Доступность:** 99.9% (профили доступны при наличии основного функционала приложения)
- **Обработка ошибок:** При ошибке загрузки профиля автоматически переключаться на "По умолчанию" с уведомлением пользователя
- **Offline режим:** Настройки профилей и переключение работают без интернета, применяются к локально кэшированным чатам

### NFR-3: Безопасность

- **Хранение данных:** Все настройки профилей хранятся локально в зашифрованной SQLite базе
- **Приватность:** Telegram API не информируется о существовании профилей, это клиентская функциональность
- **Изоляция:** Скрытые чаты не оставляют следов в истории поиска, недавних файлах или упоминаниях

### NFR-4: Поддерживаемость

**Соответствие Принципу 1:**
- Покрытие документацией: 100% публичных API профилей
- Сложность кода: Cyclomatic complexity < 10 для логики фильтрации
- Модульность: Система профилей реализована как отдельный модуль с четким интерфейсом

### NFR-5: Тестируемость

**Соответствие Принципу 2:**
- Unit-тесты: > 70% coverage логики профилей и фильтрации
- Integration-тесты: 
  - Создание/редактирование/удаление профилей
  - Применение правил фильтрации
  - Переключение профилей
  - Интеграция с папками Telegram
- E2E-тесты:
  - Полный пользовательский сценарий: создание профиля "Работа" → настройка видимости → переключение → проверка фильтрации
  - Сценарий с новыми контактами
  - Сценарий whitelist/blacklist

## 4. Пользовательские сценарии

### Сценарий 1: Создание рабочего профиля

**Актор:** Разработчик Иван

**Предусловие:** Иван первый раз открыл Workgram, есть профиль "По умолчанию"

**Основной поток:**
1. Иван открывает меню управления профилями
2. Нажимает "Создать новый профиль"
3. Вводит название "Работа 💼"
4. Выбирает иконку (портфель) и цвет (синий)
5. В настройках видимости выбирает "Показать только выбранные"
6. Добавляет в whitelist:
   - Папку Telegram "Клиенты"
   - Папку "Команда разработки"
   - Конкретные чаты: CEO, Project Manager
7. Настраивает уведомления: "Только от избранных"
8. Добавляет CEO и Project Manager в список приоритетных уведомлений
9. Сохраняет профиль
10. Переключается на профиль "Работа 💼"
11. Видит только рабочие чаты, все личные группы и каналы с мемами скрыты

**Ожидаемый результат:**
- Профиль создан и активирован
- В списке диалогов только рабочие чаты
- Уведомления приходят только от CEO и PM
- Остальные чаты недоступны, пока профиль активен

**Метрики успеха:**
- Время создания и настройки профиля: < 3 минут для опытного пользователя
- Точность фильтрации: 100% (все нерабочие чаты скрыты)

---

### Сценарий 2: Быстрое переключение в конце рабочего дня

**Актор:** Фрилансер Мария

**Предусловие:** Мария работает в профиле "Клиент А", рабочий день закончен

**Основной поток:**
1. Мария нажимает на индикатор текущего профиля в шапке
2. Открывается список профилей: "По умолчанию", "Клиент А" (активен), "Клиент Б", "Личное"
3. Мария выбирает профиль "Личное"
4. Интерфейс обновляется за 1.5 секунды
5. Теперь видны только личные чаты с друзьями и семьей
6. Рабочие чаты полностью скрыты
7. Уведомления от рабочих чатов отключены

**Ожидаемый результат:**
- Профиль успешно переключен
- Рабочий контент недоступен
- Мария отдыхает без отвлечений на работу

**Метрики успеха:**
- Время переключения: < 2 секунд
- Количество действий: 2 клика

---

### Сценарий 3: Обработка нового контакта

**Актор:** Менеджер Алексей

**Предусловие:** Алексей работает в профиле "Проект X" с настройкой "новые контакты требуют одобрения"

**Основной поток:**
1. Коллега добавляет Алексея в новую рабочую группу "Проект Y"
2. Workgram детектирует новый чат
3. В интерфейсе управления профилями появляется бейдж "1 на рассмотрении"
4. Алексей открывает раздел "На рассмотрении"
5. Видит "Проект Y" с превью последнего сообщения
6. Нажимает "Одобрить для текущего профиля"
7. Чат становится видимым в профиле "Проект X"
8. Алексей может начать переписку

**Альтернативный поток (отклонение):**
- На шаге 6 Алексей нажимает "Скрыть"
- Чат добавляется в blacklist профиля "Проект X"
- Чат остается видимым в профиле "По умолчанию"

**Ожидаемый результат:**
- Новый контакт обработан согласно настройкам профиля
- Пользователь сохраняет контроль над видимым контентом

---

### Сценарий 4: Временный доступ к скрытому контенту

**Актор:** Дизайнер Ольга

**Предусловие:** Ольга в профиле "Фокус", нужно проверить сообщение из скрытого личного чата

**Основной поток:**
1. Ольга открывает меню управления профилями
2. Нажимает "Показать все на 5 минут"
3. Интерфейс обновляется, отображаются все чаты включая скрытые
4. Скрытые чаты помечены визуально (например, полупрозрачные или с иконкой 👁️)
5. Ольга находит нужный чат, читает сообщение, отвечает
6. Через 5 минут появляется уведомление "Временный доступ истекает через 30 секунд"
7. Через 5 минут 30 секунд интерфейс возвращается к профилю "Фокус"
8. Скрытые чаты снова недоступны

**Ожидаемый результат:**
- Быстрый доступ к скрытому контенту без смены профиля
- Автоматический возврат к фокусному режиму

## 5. Критерии успеха

Функция считается успешной, если:

1. **Метрика фокусировки:** Пользователи сообщают о снижении времени, проведенного в отвлекающих чатах, на 60% при использовании рабочих профилей

2. **Скорость переключения:** 90% переключений между профилями выполняются быстрее 2 секунд

3. **Точность фильтрации:** 99.9% скрытого контента действительно не отображается в интерфейсе

4. **Удобство настройки:** Пользователи создают и настраивают новый профиль за 5 минут или меньше (среднее время)

5. **Adoption rate:** 40% активных пользователей создают минимум 1 дополнительный профиль в первый месяц

6. **Retention:** Пользователи, создавшие профили, используют функцию переключения минимум 3 раза в неделю

7. **Удовлетворенность:** NPS (Net Promoter Score) для функции профилей > 40

8. **Производительность:** Система профилей не увеличивает время загрузки приложения более чем на 200ms

9. **Стабильность:** Количество крашей, связанных с профилями, < 0.1% от общих запусков приложения

10. **Обратная связь:** 80% пользователей в опросе отмечают, что профили помогают сосредоточиться на работе

## 6. Ключевые сущности

### Profile (Профиль)
- **ID:** Уникальный идентификатор профиля
- **Название:** Пользовательское имя профиля (3-30 символов)
- **Описание:** Опциональное текстовое описание (до 200 символов)
- **Иконка:** Emoji или символ для визуальной идентификации
- **Цвет:** Цветовой код для визуальной идентификации (hex)
- **Режим фильтрации:** "Показать все", "Скрыть все", "Выборочно"
- **Whitelist:** Список ID чатов/каналов/контактов для отображения
- **Blacklist:** Список ID чатов/каналов/контактов для скрытия
- **Папки:** Список ID папок Telegram, видимых в профиле
- **Настройки уведомлений:** Правила для уведомлений
- **Поведение для новых контактов:** "Показывать автоматически" или "Требуется одобрение"
- **Создан:** Дата и время создания
- **Последнее использование:** Дата и время последней активации

### FilterRule (Правило фильтрации)
- **ID профиля:** Ссылка на профиль
- **ID цели:** ID чата/канала/контакта/папки
- **Тип цели:** "chat", "channel", "group", "contact", "folder"
- **Действие:** "show" (whitelist) или "hide" (blacklist)
- **Приоритет:** Для разрешения конфликтов
- **Создано:** Дата добавления правила

### NotificationRule (Правило уведомлений)
- **ID профиля:** Ссылка на профиль
- **ID чата:** Ссылка на чат (null для глобальных правил)
- **Включены:** Boolean
- **Приоритет:** "critical", "normal", "silent"
- **Звук:** Boolean
- **Вибрация:** Boolean
- **Экран блокировки:** Boolean

### PendingContact (Контакт на рассмотрении)
- **ID профиля:** Ссылка на профиль
- **ID контакта:** ID нового чата/канала
- **Тип:** "chat", "channel", "group"
- **Дата появления:** Когда контакт стал доступен
- **Превью:** Последнее сообщение для контекста
- **Статус:** "pending", "approved", "rejected"

## 7. Допущения и ограничения

### Допущения
1. Пользователь имеет базовые знания о системе папок Telegram
2. Telegram API предоставляет доступ к информации о папках через клиентское приложение
3. Локальное хранилище устройства достаточно для хранения профилей (~ 10 MB на 100 профилей)
4. Пользователь самостоятельно категоризирует чаты по важности (нет AI-классификации)

### Ограничения
1. В первой версии нет синхронизации профилей между устройствами
2. Система не анализирует содержимое сообщений для автоматической классификации
3. Не поддерживается автоматическое переключение профилей по расписанию
4. Максимальное количество профилей: 50 (техническое ограничение для производительности)
5. Групповые профили (shared profiles для команд) не поддерживаются в MVP

## 8. Зависимости

- **Telegram API:** Доступ к списку чатов, папок, настройкам уведомлений
- **Локальная БД:** SQLite для хранения профилей и правил фильтрации
- **Система уведомлений ОС:** Для управления push-уведомлениями

## 9. Приоритизация (Phasing)

### MVP (Minimal Viable Product) - Фаза 1
Обязательные функции для первого релиза:
- FR-1: Создание и редактирование профилей
- FR-2: Фильтрация видимости контента
- FR-4: Управление уведомлениями
- FR-7: Быстрое переключение профилей
- FR-8: Профиль по умолчанию

### Фаза 2 (3-6 месяцев после MVP)
- FR-3: Интеграция с папками Telegram
- FR-9: Быстрая навигация по папкам

### Фаза 3 (6-12 месяцев после MVP)
- FR-5: Управление новыми контактами
- FR-6: Расширенные механизмы whitelist/blacklist

## 10. Глоссарий

- **Профиль:** Именованный набор правил фильтрации контента и уведомлений
- **Whitelist:** Список явно разрешенного контента для профиля
- **Blacklist:** Список явно запрещенного контента для профиля
- **Фильтрация:** Процесс скрытия/отображения чатов согласно правилам профиля
- **Папка Telegram:** Встроенная функция Telegram для группировки чатов по категориям
- **Профиль "По умолчанию":** Встроенный неудаляемый профиль с полной видимостью контента
- **Временный доступ:** Режим кратковременного отображения всего контента без смены профиля
- **Контакт на рассмотрении:** Новый чат/канал, требующий явного одобрения пользователем

---

**Одобрения:**

| Роль            | Имя           | Дата       | Подпись |
|-----------------|---------------|------------|---------|
| Author          | AI Assistant  | 2025-10-19 | ✓       |
| Tech Reviewer   | TBD           | TBD        |         |
| Product Owner   | TBD           | TBD        |         |
